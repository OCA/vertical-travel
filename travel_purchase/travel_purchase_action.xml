<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data noupdate="1">
    <record id="travel_purchase_opened_server_action" model="ir.actions.server">
      <field name="name">Email alert when a purchase connected with a travel is opened</field>
      <field name="model_id" ref="purchase.model_purchase_order" />
      <field name="state">email</field>
      <field name="sequence">5</field>
      <field name="email">object.responsible_emails</field>
      <field name="subject">Travel alert ([[object.travel_id.name]])</field>
      <field name="message">Hello,

The purchase order ([[object.name]]) linked to the travel ([[object.travel_id.name]]) has just been opened.

Have a nice day!
      </field>
    </record>
    <record id="travel_purchase_flag_opened_server_action" model="ir.actions.server">
      <field name="name">Flag PO after sending alert</field>
      <field name="model_id" ref="purchase.model_purchase_order" />
      <field name="state">code</field>
      <field name="sequence">10</field>
      <field name="condition">object.is_opened is False</field>
      <field name="code">object.write({'is_opened': True})</field>
    </record>
    <record id="travel_purchase_opened_filter" model="ir.filters">
      <field name="name">Open</field>
      <field name="model_id">purchase.order</field>
      <field name="user_id" eval="False" />
      <field name="domain">[('state', '=', 'approved'), ('travel_id', '!=', False), ('is_opened', '=' False)]</field>
    </record>
    <record id="rule_travel_purchase_opened_action_rule" model="base.action.rule">
      <field name="name">Send an alert when a purchase order linked to a travel is opened</field>
      <field name="model_id" ref="purchase.model_purchase_order"/>
      <field name="filter_id" ref="travel_purchase_opened_filter" />
      <field name="server_action_ids" eval="[(6, 0, [ref('travel_purchase_opened_server_action'), ref('travel_purchase_flag_opened_server_action')])]"/>
    </record>
  </data>
</openerp>
